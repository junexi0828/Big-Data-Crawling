<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CoinTicker Live - Real-time Crypto Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #0b0e11;
        color: #eaecef;
        overflow-x: hidden;
      }

      /* ìƒë‹¨ í—¤ë” */
      .header {
        background: #1e2329;
        border-bottom: 1px solid #2b3139;
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5em;
        font-weight: 700;
        color: #f0b90b;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .header-nav {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .nav-item {
        color: #848e9c;
        text-decoration: none;
        padding: 8px 15px;
        border-radius: 4px;
        transition: all 0.2s;
      }

      .nav-item:hover,
      .nav-item.active {
        color: #eaecef;
        background: #2b3139;
      }

      /* ê°€ê²© í‹°ì»¤ ë°” */
      .ticker-bar {
        background: #1e2329;
        border-bottom: 1px solid #2b3139;
        padding: 10px 20px;
        display: flex;
        gap: 30px;
        overflow-x: auto;
        white-space: nowrap;
      }

      .ticker-bar::-webkit-scrollbar {
        height: 4px;
      }

      .ticker-bar::-webkit-scrollbar-track {
        background: #0b0e11;
      }

      .ticker-bar::-webkit-scrollbar-thumb {
        background: #2b3139;
        border-radius: 2px;
      }

      .ticker-item {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .ticker-symbol {
        color: #848e9c;
        font-size: 0.85em;
      }

      .ticker-price {
        font-weight: 600;
        font-size: 1em;
      }

      .ticker-change {
        font-size: 0.9em;
        padding: 2px 8px;
        border-radius: 3px;
      }

      .ticker-change.up {
        color: #0ecb81;
        background: rgba(14, 203, 129, 0.1);
      }

      .ticker-change.down {
        color: #f6465d;
        background: rgba(246, 70, 93, 0.1);
      }

      /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
      .main-layout {
        display: grid;
        grid-template-columns: 280px 1fr 320px;
        gap: 1px;
        background: #2b3139;
        min-height: calc(100vh - 100px);
      }

      /* ì™¼ìª½ ì‚¬ì´ë“œë°” - ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ */
      .market-list {
        background: #1e2329;
        padding: 15px;
        overflow-y: auto;
      }

      .market-search {
        width: 100%;
        padding: 10px;
        background: #2b3139;
        border: 1px solid #474d57;
        border-radius: 4px;
        color: #eaecef;
        margin-bottom: 15px;
      }

      .market-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        border-bottom: 1px solid #2b3139;
        padding-bottom: 10px;
      }

      .market-tab {
        padding: 5px 10px;
        color: #848e9c;
        cursor: pointer;
        font-size: 0.9em;
        border-bottom: 2px solid transparent;
      }

      .market-tab.active {
        color: #f0b90b;
        border-bottom-color: #f0b90b;
      }

      .market-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .market-item:hover {
        background: #2b3139;
      }

      .market-item.active {
        background: #2b3139;
        border-left: 3px solid #f0b90b;
      }

      .market-symbol {
        font-weight: 600;
        font-size: 0.95em;
      }

      .market-price {
        text-align: right;
      }

      .market-price-value {
        font-size: 0.95em;
      }

      /* ì¤‘ì•™ - ì°¨íŠ¸ & ë‰´ìŠ¤ */
      .chart-section {
        background: #1e2329;
        display: flex;
        flex-direction: column;
      }

      .chart-header {
        padding: 15px 20px;
        border-bottom: 1px solid #2b3139;
      }

      .chart-symbol {
        font-size: 1.5em;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .chart-stats {
        display: flex;
        gap: 30px;
        font-size: 0.9em;
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .stat-label {
        color: #848e9c;
        font-size: 0.85em;
      }

      .stat-value {
        font-weight: 600;
      }

      .chart-container {
        padding: 20px;
        flex: 1;
        position: relative;
      }

      .chart-timeframe {
        display: flex;
        gap: 10px;
        padding: 10px 20px;
        border-bottom: 1px solid #2b3139;
      }

      .timeframe-btn {
        padding: 5px 12px;
        background: transparent;
        border: none;
        color: #848e9c;
        cursor: pointer;
        border-radius: 4px;
        font-size: 0.9em;
      }

      .timeframe-btn:hover {
        background: #2b3139;
      }

      .timeframe-btn.active {
        background: #2b3139;
        color: #f0b90b;
      }

      /* ë‰´ìŠ¤ ì„¹ì…˜ */
      .news-section {
        background: #1e2329;
        padding: 20px;
        margin-top: 1px;
        max-height: 400px;
        overflow-y: auto;
      }

      .news-title {
        font-size: 1.1em;
        font-weight: 700;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .news-item {
        padding: 15px;
        background: #2b3139;
        border-radius: 6px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .news-item:hover {
        background: #343a46;
      }

      .news-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }

      .news-source {
        color: #848e9c;
        font-size: 0.85em;
      }

      .news-time {
        color: #848e9c;
        font-size: 0.8em;
      }

      .news-headline {
        font-weight: 600;
        line-height: 1.4;
        margin-bottom: 8px;
      }

      .news-sentiment {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 3px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .news-sentiment.positive {
        color: #0ecb81;
        background: rgba(14, 203, 129, 0.1);
      }

      .news-sentiment.negative {
        color: #f6465d;
        background: rgba(246, 70, 93, 0.1);
      }

      .news-sentiment.neutral {
        color: #848e9c;
        background: rgba(132, 142, 156, 0.1);
      }

      /* ì˜¤ë¥¸ìª½ - ê¸°ìˆ ì  ì§€í‘œ & ì•Œë¦¼ */
      .indicators-panel {
        background: #1e2329;
        overflow-y: auto;
      }

      .panel-section {
        padding: 15px;
        border-bottom: 1px solid #2b3139;
      }

      .panel-title {
        font-size: 1em;
        font-weight: 700;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .indicator-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #2b3139;
      }

      .indicator-row:last-child {
        border-bottom: none;
      }

      .indicator-name {
        color: #848e9c;
        font-size: 0.9em;
      }

      .indicator-value-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .indicator-value {
        font-weight: 600;
      }

      .indicator-signal {
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.75em;
        font-weight: 600;
      }

      .indicator-signal.buy {
        color: #0ecb81;
        background: rgba(14, 203, 129, 0.1);
      }

      .indicator-signal.sell {
        color: #f6465d;
        background: rgba(246, 70, 93, 0.1);
      }

      .indicator-signal.neutral {
        color: #848e9c;
        background: rgba(132, 142, 156, 0.1);
      }

      /* ì•Œë¦¼ íŒ¨ë„ */
      .alert-item {
        padding: 12px;
        background: #2b3139;
        border-radius: 6px;
        margin-bottom: 8px;
        border-left: 3px solid;
      }

      .alert-item.critical {
        border-left-color: #f6465d;
      }

      .alert-item.warning {
        border-left-color: #f0b90b;
      }

      .alert-item.info {
        border-left-color: #0ecb81;
      }

      .alert-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }

      .alert-severity {
        font-size: 0.75em;
        font-weight: 700;
        text-transform: uppercase;
      }

      .alert-time {
        font-size: 0.75em;
        color: #848e9c;
      }

      .alert-message {
        font-size: 0.85em;
        line-height: 1.4;
      }

      /* ì§€ì§€ì„ /ì €í•­ì„  */
      .level-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #2b3139;
        border-radius: 6px;
        margin-bottom: 8px;
      }

      .level-type {
        font-size: 0.85em;
        font-weight: 600;
      }

      .level-type.resistance {
        color: #f6465d;
      }

      .level-type.support {
        color: #0ecb81;
      }

      .level-price {
        font-weight: 600;
      }

      .level-strength {
        font-size: 0.75em;
        color: #848e9c;
      }

      /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-track {
        background: #0b0e11;
      }

      ::-webkit-scrollbar-thumb {
        background: #2b3139;
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #474d57;
      }

      /* ë°˜ì‘í˜• */
      @media (max-width: 1200px) {
        .main-layout {
          grid-template-columns: 1fr;
        }

        .market-list,
        .indicators-panel {
          display: none;
        }
      }

      /* ì• ë‹ˆë©”ì´ì…˜ */
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .live-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #0ecb81;
        border-radius: 50%;
        animation: pulse 2s infinite;
        margin-right: 8px;
      }

      /* ì½”ì¸ ìƒì„¸ ì •ë³´ íŒ¨ë„ */
      .loading {
        text-align: center;
        padding: 20px;
        color: #848e9c;
      }
    </style>
  </head>
  <body>
    <!-- í—¤ë” -->
    <div class="header">
      <div class="logo">
        <span>ğŸª™</span>
        <span>CoinTicker</span>
        <span style="font-size: 0.5em; color: #848e9c">LIVE</span>
      </div>
      <div class="header-nav">
        <a href="#" class="nav-item active">Markets</a>
        <a href="#" class="nav-item">Trade</a>
        <a href="#" class="nav-item">News</a>
        <a href="#" class="nav-item">Alerts</a>
        <a href="index.html" class="nav-item">About</a>
      </div>
    </div>

    <!-- ê°€ê²© í‹°ì»¤ ë°” -->
    <div class="ticker-bar" id="tickerBar">
      <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
    <div class="main-layout">
      <!-- ì™¼ìª½: ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ -->
      <div class="market-list">
        <input
          type="text"
          class="market-search"
          placeholder="ğŸ” Search markets..."
        />
        <div class="market-tabs">
          <div class="market-tab active">USDT</div>
          <div class="market-tab">BTC</div>
          <div class="market-tab">Favorites</div>
        </div>
        <div id="marketList">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
      </div>

      <!-- ì¤‘ì•™: ì°¨íŠ¸ & ë‰´ìŠ¤ -->
      <div class="chart-section">
        <div class="chart-header">
          <div class="chart-symbol" id="currentSymbol">BTC/USDT</div>
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Price</span>
              <span class="stat-value" id="currentPrice">$43,850.00</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">24h Change</span>
              <span class="stat-value" id="priceChange" style="color: #0ecb81"
                >+2.35%</span
              >
            </div>
            <div class="stat-item">
              <span class="stat-label">24h High</span>
              <span class="stat-value">$44,250.00</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">24h Low</span>
              <span class="stat-value">$42,100.00</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">24h Volume</span>
              <span class="stat-value">$28.5B</span>
            </div>
          </div>
        </div>

        <div class="chart-timeframe">
          <button class="timeframe-btn">1m</button>
          <button class="timeframe-btn">5m</button>
          <button class="timeframe-btn">15m</button>
          <button class="timeframe-btn active">1h</button>
          <button class="timeframe-btn">4h</button>
          <button class="timeframe-btn">1D</button>
          <button class="timeframe-btn">1W</button>
        </div>

        <div class="chart-container">
          <canvas id="priceChart"></canvas>
        </div>

        <div class="news-section">
          <div class="news-title">
            <span class="live-indicator"></span>
            <span>Real-time News Feed</span>
          </div>
          <div id="newsFeed">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ê¸°ìˆ ì  ì§€í‘œ & ì•Œë¦¼ -->
      <div class="indicators-panel">
        <!-- ì½”ì¸ ìƒì„¸ ì •ë³´ íŒ¨ë„ (ì½”ì¸ í´ë¦­ ì‹œ í‘œì‹œ) -->
        <div class="panel-section" id="coinDetailPanel" style="display: none;">
          <div class="panel-title">
            <span>ğŸ’¡</span>
            <span id="coinDetailTitle">Coin Details</span>
            <button onclick="closeCoinDetail()" style="margin-left: auto; background: transparent; border: none; color: #848e9c; cursor: pointer; font-size: 1.2em;">âœ•</button>
          </div>
          <div id="coinDetailContent">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>

        <div class="panel-section">
          <div class="panel-title">
            <span>ğŸ“Š</span>
            <span>Technical Indicators</span>
          </div>
          <div id="indicatorsList">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>

        <div class="panel-section">
          <div class="panel-title">
            <span>ğŸ“</span>
            <span>Support & Resistance</span>
          </div>
          <div id="levelsList">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>

        <div class="panel-section">
          <div class="panel-title">
            <span>ğŸ””</span>
            <span>Live Alerts</span>
          </div>
          <div id="alertsList">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // === ì‹¤ì‹œê°„ API ì—°ë™ ì‹œìŠ¤í…œ ===

      // ë°±ì—”ë“œ API ê¸°ë³¸ URL
      const API_BASE_URL = window.location.hostname === 'localhost'
        ? 'http://localhost:5000'
        : 'http://localhost:5000'; // í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‹¤ì œ ë°±ì—”ë“œ URLë¡œ ë³€ê²½

      // ë§ˆì¼“ ë°ì´í„° (ì´ˆê¸° ë”ë¯¸ ë°ì´í„° - API ë¡œë”© ì „ í‘œì‹œìš©)
      let markets = [
        { symbol: "BTC/USDT", price: 43850.0, change: 2.35, volume: "28.5B" },
        { symbol: "ETH/USDT", price: 2285.5, change: 1.82, volume: "15.2B" },
        { symbol: "BNB/USDT", price: 315.2, change: -0.45, volume: "2.1B" },
        { symbol: "SOL/USDT", price: 98.45, change: 5.67, volume: "3.8B" },
        { symbol: "ADA/USDT", price: 0.485, change: -1.23, volume: "1.2B" },
        { symbol: "XRP/USDT", price: 0.625, change: 3.14, volume: "2.5B" },
        { symbol: "DOT/USDT", price: 6.82, change: 0.89, volume: "850M" },
        { symbol: "DOGE/USDT", price: 0.0895, change: -2.15, volume: "1.5B" },
      ];

      const indicators = [
        {
          name: "RSI(14)",
          value: "48.94",
          signal: "neutral",
          color: "#848e9c",
        },
        { name: "MACD", value: "-53.28", signal: "buy", color: "#0ecb81" },
        {
          name: "ADX(14)",
          value: "19.20",
          signal: "neutral",
          color: "#848e9c",
        },
        {
          name: "Williams %R",
          value: "-38.39",
          signal: "neutral",
          color: "#848e9c",
        },
        {
          name: "CCI(14)",
          value: "-17.58",
          signal: "neutral",
          color: "#848e9c",
        },
        { name: "ROC(12)", value: "0.92", signal: "buy", color: "#0ecb81" },
        {
          name: "ATR(14)",
          value: "125.50",
          signal: "neutral",
          color: "#848e9c",
        },
        {
          name: "Stoch RSI",
          value: "65.2",
          signal: "neutral",
          color: "#848e9c",
        },
      ];

      // ì§€ì§€ì„ /ì €í•­ì„  ë°ì´í„° ìƒì„± í•¨ìˆ˜ (í˜„ì¬ ê°€ê²© ê¸°ì¤€)
      function generateSupportResistanceLevels(currentPrice) {
        const levels = [];
        // ì €í•­ì„  (í˜„ì¬ê°€ë³´ë‹¤ ë†’ì€ ê°€ê²©)
        levels.push({ type: "resistance", price: currentPrice * 1.15, strength: "Strong" });
        levels.push({ type: "resistance", price: currentPrice * 1.08, strength: "Medium" });
        levels.push({ type: "resistance", price: currentPrice * 1.03, strength: "Weak" });
        // ì§€ì§€ì„  (í˜„ì¬ê°€ë³´ë‹¤ ë‚®ì€ ê°€ê²©)
        levels.push({ type: "support", price: currentPrice * 0.97, strength: "Weak" });
        levels.push({ type: "support", price: currentPrice * 0.92, strength: "Medium" });
        levels.push({ type: "support", price: currentPrice * 0.85, strength: "Strong" });
        return levels.sort((a, b) => b.price - a.price);
      }

      let levels = generateSupportResistanceLevels(43850);

      // ì•Œë¦¼ ë°ì´í„° ìƒì„± í•¨ìˆ˜ (ìµœì‹  ë‚ ì§œ ê¸°ì¤€)
      function generateRecentAlerts() {
        const now = new Date();
        return [
          {
            severity: "critical",
            time: "2m ago",
            message: "BTC broke resistance at $44,000",
          },
          {
            severity: "warning",
            time: "15m ago",
            message: "MACD golden cross detected",
          },
          {
            severity: "info",
            time: "32m ago",
            message: "Volume spike: +45% in last hour",
          },
          {
            severity: "warning",
            time: "1h ago",
            message: "RSI approaching overbought (68.5)",
          },
        ];
      }

      let alerts = generateRecentAlerts();

      // ë‰´ìŠ¤ ë°ì´í„° ìƒì„± í•¨ìˆ˜ (ìµœì‹  ë‚ ì§œ ê¸°ì¤€)
      function generateRecentNews() {
        const now = new Date();
        return [
          {
            source: "CoinDesk",
            time: "5 min ago",
            headline: "Bitcoin ETF sees $2B inflow in single day",
            sentiment: "positive",
          },
          {
            source: "Bloomberg",
            time: "23 min ago",
            headline: "SEC approves spot Bitcoin ETF applications",
            sentiment: "positive",
          },
          {
            source: "Reuters",
            time: "1 hour ago",
            headline: "Ethereum network completes major upgrade",
            sentiment: "positive",
          },
          {
            source: "Cointelegraph",
            time: "2 hours ago",
            headline: "Major exchange announces new security measures",
            sentiment: "neutral",
          },
          {
            source: "CoinTelegraph",
            time: "3 hours ago",
            headline: "Market analysis shows bullish trend continuation",
            sentiment: "positive",
          },
          {
            source: "Decrypt",
            time: "4 hours ago",
            headline: "Institutional investors increase crypto allocations",
            sentiment: "positive",
          },
        ];
      }

      let news = generateRecentNews();

      let chartInstance = null;
      let currentSymbol = "BTCUSDT";
      let isFirstLoad = true; // ì²« ë¡œë“œ ì—¬ë¶€

      // === ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ë“¤ ===

      // 0. ë°±ì—”ë“œ API - ì‹œì¥ íŠ¸ë Œë“œ ë°ì´í„°
      async function fetchBackendMarketTrends() {
        try {
          console.log("ğŸ“Š ë°±ì—”ë“œ API: ì‹œì¥ íŠ¸ë Œë“œ ë°ì´í„° í˜¸ì¶œ ì¤‘...");
          const response = await fetch(`${API_BASE_URL}/api/market/trends?limit=10`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.trends && data.trends.length > 0) {
            // ë°±ì—”ë“œ ë°ì´í„°ë¥¼ ìš°ë¦¬ í¬ë§·ìœ¼ë¡œ ë³€í™˜
            const symbolMap = {
              'BTC': 'BTC/USDT',
              'ETH': 'ETH/USDT',
              'BNB': 'BNB/USDT',
              'SOL': 'SOL/USDT',
              'ADA': 'ADA/USDT',
              'XRP': 'XRP/USDT',
              'DOT': 'DOT/USDT',
              'DOGE': 'DOGE/USDT'
            };

            // ì‹¬ë³¼ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ìµœì‹  ë°ì´í„°ë§Œ ì‚¬ìš©
            const latestBySymbol = {};
            data.trends.forEach(trend => {
              const symbol = symbolMap[trend.symbol] || `${trend.symbol}/USDT`;
              if (!latestBySymbol[symbol] || new Date(trend.timestamp) > new Date(latestBySymbol[symbol].timestamp)) {
                latestBySymbol[symbol] = {
                  symbol: symbol,
                  price: trend.price,
                  change: trend.change_24h || 0,
                  volume: formatVolume(trend.volume_24h || 0)
                };
              }
            });

            // ê¸°ì¡´ markets ë°°ì—´ ì—…ë°ì´íŠ¸ (ë°±ì—”ë“œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©)
            Object.values(latestBySymbol).forEach(market => {
              const index = markets.findIndex(m => m.symbol === market.symbol);
              if (index >= 0) {
                markets[index] = market;
              } else {
                markets.push(market);
              }
            });

            console.log(`âœ… ë°±ì—”ë“œ API: ${Object.keys(latestBySymbol).length}ê°œ ì½”ì¸ ë°ì´í„° ì—…ë°ì´íŠ¸`);
            renderTickerBar();
            renderMarketList();

            // ì²« ë²ˆì§¸ ì½”ì¸ ìë™ ì„ íƒ (ì´ˆê¸° ë¡œë“œ ì‹œì—ë§Œ)
            if (isFirstLoad && markets.length > 0) {
              isFirstLoad = false;
              handleCoinClick(markets[0].symbol);
            }
            return true;
          }
          return false;
        } catch (error) {
          console.error("âŒ ë°±ì—”ë“œ API ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ì™¸ë¶€ APIë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
          return false;
        }
      }

      // 1. CoinGecko API - ì‹¤ì‹œê°„ ê°€ê²© ë°ì´í„° (ë°±ì—”ë“œì— ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ ì‚¬ìš©)
      async function fetchCoinGeckoPrices() {
        try {
          console.log("ğŸ“Š CoinGecko API í˜¸ì¶œ ì¤‘...");
          const response = await fetch(
            "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=8&page=1&sparkline=false&price_change_percentage=24h"
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (!data || !Array.isArray(data) || data.length === 0) {
            console.warn("CoinGecko: ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„° ìœ ì§€.");
            return;
          }

          // CoinGecko ë°ì´í„°ë¥¼ ìš°ë¦¬ í¬ë§·ìœ¼ë¡œ ë³€í™˜
          markets = data.map((coin) => {
            const symbolMap = {
              bitcoin: "BTC/USDT",
              ethereum: "ETH/USDT",
              binancecoin: "BNB/USDT",
              solana: "SOL/USDT",
              cardano: "ADA/USDT",
              ripple: "XRP/USDT",
              polkadot: "DOT/USDT",
              dogecoin: "DOGE/USDT",
            };

            return {
              symbol: symbolMap[coin.id] || coin.symbol.toUpperCase() + "/USDT",
              price: coin.current_price,
              change: coin.price_change_percentage_24h || 0,
              volume: formatVolume(coin.total_volume),
              coinId: coin.id, // CoinGecko ID ì €ì¥
            };
          });

          console.log(`âœ… CoinGecko: ${markets.length}ê°œ ì½”ì¸ ë°ì´í„° ì—…ë°ì´íŠ¸`);
          renderTickerBar();
          renderMarketList();

          // ì²« ë²ˆì§¸ ì½”ì¸ ìë™ ì„ íƒ (ì´ˆê¸° ë¡œë“œ ì‹œì—ë§Œ)
          if (isFirstLoad && markets.length > 0) {
            isFirstLoad = false;
            handleCoinClick(markets[0].symbol);
          }
        } catch (error) {
          console.error("âŒ CoinGecko API ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ê¸°ì¡´ ë°ì´í„°ë¡œ ê³„ì† í‘œì‹œë©ë‹ˆë‹¤.");
        }
      }

      // 2. Binance API - ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ë°ì´í„°
      async function fetchBinanceKlines(
        symbol = "BTCUSDT",
        interval = "1h",
        limit = 100
      ) {
        try {
          console.log(`ğŸ“ˆ Binance ìº”ë“¤ ë°ì´í„° í˜¸ì¶œ ì¤‘... (${symbol})`);
          const response = await fetch(
            `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (!data || !Array.isArray(data) || data.length === 0) {
            console.warn("Binance: ìº”ë“¤ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
            return;
          }

          // Binance ìº”ë“¤ ë°ì´í„° íŒŒì‹±
          const candleData = data.map((candle) => ({
            x: new Date(candle[0]),
            o: parseFloat(candle[1]),
            h: parseFloat(candle[2]),
            l: parseFloat(candle[3]),
            c: parseFloat(candle[4]),
          }));

          console.log(`âœ… Binance: ${candleData.length}ê°œ ìº”ë“¤ ì—…ë°ì´íŠ¸`);
          updateChart(candleData);
        } catch (error) {
          console.error("âŒ Binance ìº”ë“¤ API ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
        }
      }

      // 3. Binance API - 24ì‹œê°„ ê°€ê²© í†µê³„
      async function fetchBinance24hrStats(symbol = "BTCUSDT") {
        try {
          console.log(`ğŸ’° Binance 24hr í†µê³„ í˜¸ì¶œ ì¤‘... (${symbol})`);
          const response = await fetch(
            `https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (!data || !data.lastPrice) {
            console.warn("Binance: 24hr í†µê³„ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
            return;
          }

          // í˜„ì¬ ê°€ê²© ì •ë³´ ì—…ë°ì´íŠ¸
          document.getElementById("currentPrice").textContent =
            "$" + parseFloat(data.lastPrice).toLocaleString();
          document.getElementById("priceChange").textContent =
            (data.priceChangePercent >= 0 ? "+" : "") +
            parseFloat(data.priceChangePercent).toFixed(2) +
            "%";
          document.getElementById("priceChange").style.color =
            data.priceChangePercent >= 0 ? "#0ecb81" : "#f6465d";

          console.log(
            `âœ… Binance: ê°€ê²© $${parseFloat(
              data.lastPrice
            ).toLocaleString()} ì—…ë°ì´íŠ¸`
          );
        } catch (error) {
          console.error("âŒ Binance 24hr í†µê³„ ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ê°€ê²© ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
        }
      }

      // 4. ë°±ì—”ë“œ API - ë‰´ìŠ¤ ë°ì´í„°
      async function fetchBackendNews() {
        try {
          console.log("ğŸ“° ë°±ì—”ë“œ API: ë‰´ìŠ¤ ë°ì´í„° í˜¸ì¶œ ì¤‘...");
          const response = await fetch(`${API_BASE_URL}/api/news/latest?limit=10`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.news && data.news.length > 0) {
            // ê° ë‰´ìŠ¤ì˜ ê°ì„± ë¶„ì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const newsWithSentiment = await Promise.all(
              data.news.slice(0, 6).map(async (item) => {
                try {
                  const sentimentResponse = await fetch(`${API_BASE_URL}/api/news/${item.id}/sentiment`);
                  if (sentimentResponse.ok) {
                    const sentimentData = await sentimentResponse.json();
                    const sentimentScore = sentimentData.sentiment_score || 0;
                    let sentiment = "neutral";
                    if (sentimentScore > 0.1) sentiment = "positive";
                    else if (sentimentScore < -0.1) sentiment = "negative";

                    const publishedAt = new Date(item.published_at);
                    const timeDiff = Math.floor((Date.now() - publishedAt.getTime()) / 60000);
                    const timeAgo = timeDiff < 60
                      ? `${timeDiff} min ago`
                      : `${Math.floor(timeDiff / 60)} hours ago`;

                    return {
                      source: item.source,
                      time: timeAgo,
                      headline: item.title,
                      sentiment: sentiment,
                      url: item.url,
                    };
                  }
                } catch (e) {
                  // ê°ì„± ë¶„ì„ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’
                }

                const publishedAt = new Date(item.published_at);
                const timeDiff = Math.floor((Date.now() - publishedAt.getTime()) / 60000);
                const timeAgo = timeDiff < 60
                  ? `${timeDiff} min ago`
                  : `${Math.floor(timeDiff / 60)} hours ago`;

                return {
                  source: item.source,
                  time: timeAgo,
                  headline: item.title,
                  sentiment: "neutral",
                  url: item.url,
                };
              })
            );

            news = newsWithSentiment.filter(n => n);
            console.log(`âœ… ë°±ì—”ë“œ API: ${news.length}ê°œ ë‰´ìŠ¤ ì—…ë°ì´íŠ¸`);
            renderNews();
            return true;
          }
          return false;
        } catch (error) {
          console.error("âŒ ë°±ì—”ë“œ ë‰´ìŠ¤ API ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ì™¸ë¶€ APIë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
          return false;
        }
      }

      // 5. CryptoCompare API - ì‹¤ì‹œê°„ ë‰´ìŠ¤ (ë°±ì—”ë“œì— ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ ì‚¬ìš©)
      async function fetchCryptoNews() {
        try {
          console.log("ğŸ“° CryptoCompare ë‰´ìŠ¤ í˜¸ì¶œ ì¤‘...");
          const response = await fetch(
            "https://min-api.cryptocompare.com/data/v2/news/?lang=EN&categories=BTC,ETH,Blockchain"
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();

          if (
            result &&
            result.Data &&
            Array.isArray(result.Data) &&
            result.Data.length > 0
          ) {
            news = result.Data.slice(0, 6).map((item) => {
              const timeDiff = Math.floor(
                (Date.now() / 1000 - item.published_on) / 60
              );
              const timeAgo =
                timeDiff < 60
                  ? `${timeDiff} min ago`
                  : `${Math.floor(timeDiff / 60)} hours ago`;

              // demo.htmlê³¼ ë™ì¼í•œ ê°ì„± ë¶„ì„ (í‚¤ì›Œë“œ ê¸°ë°˜)
              let sentiment = "neutral";
              const title = item.title.toLowerCase();
              const body = item.body ? item.body.toLowerCase() : "";

              const positiveWords = [
                "surge", "rise", "bull", "gain", "up", "high", "rally",
                "soar", "boost", "positive", "growth"
              ];
              const negativeWords = [
                "fall", "drop", "bear", "crash", "down", "low", "decline",
                "plunge", "negative", "loss"
              ];

              const positiveCount = positiveWords.filter(
                (word) => title.includes(word) || body.includes(word)
              ).length;
              const negativeCount = negativeWords.filter(
                (word) => title.includes(word) || body.includes(word)
              ).length;

              if (positiveCount > negativeCount) {
                sentiment = "positive";
              } else if (negativeCount > positiveCount) {
                sentiment = "negative";
              }

              return {
                source: item.source_info.name,
                time: timeAgo,
                headline: item.title,
                sentiment: sentiment,
                url: item.url,
              };
            });

            console.log(`âœ… CryptoCompare: ${news.length}ê°œ ë‰´ìŠ¤ ì—…ë°ì´íŠ¸`);
            renderNews();
          } else {
            console.warn(
              "CryptoCompare: ë‰´ìŠ¤ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„° ìœ ì§€."
            );
          }
        } catch (error) {
          console.error("âŒ CryptoCompare ë‰´ìŠ¤ ì—ëŸ¬:", error);
          console.log("ğŸ“Œ ê¸°ì¡´ ë‰´ìŠ¤ë¡œ ê³„ì† í‘œì‹œë©ë‹ˆë‹¤.");
        }
      }

      // 6. ë°±ì—”ë“œ API - ê¸°ìˆ ì  ì§€í‘œ
      async function fetchBackendTechnicalIndicators(symbol = "BTC") {
        try {
          console.log(`ğŸ“Š ë°±ì—”ë“œ API: ê¸°ìˆ ì  ì§€í‘œ í˜¸ì¶œ ì¤‘... (${symbol})`);
          const response = await fetch(`${API_BASE_URL}/api/technical-indicators/${symbol}`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.indicators) {
            const ind = data.indicators;

            // RSI ì‹ í˜¸ íŒë‹¨
            let rsiSignal = "neutral";
            let rsiColor = "#848e9c";
            if (ind.rsi > 70) {
              rsiSignal = "sell";
              rsiColor = "#f6465d";
            } else if (ind.rsi < 30) {
              rsiSignal = "buy";
              rsiColor = "#0ecb81";
            }

            // MACD ì‹ í˜¸ íŒë‹¨
            let macdSignal = "neutral";
            let macdColor = "#848e9c";
            if (ind.macd && ind.macd_signal) {
              if (ind.macd.value > ind.macd.signal) {
                macdSignal = "buy";
                macdColor = "#0ecb81";
              } else {
                macdSignal = "sell";
                macdColor = "#f6465d";
              }
            }

            // ì§€í‘œ ì—…ë°ì´íŠ¸
            indicators[0] = {
              name: "RSI(14)",
              value: ind.rsi ? ind.rsi.toFixed(2) : "N/A",
              signal: rsiSignal,
              color: rsiColor,
            };

            if (ind.macd) {
              indicators[1] = {
                name: "MACD",
                value: ind.macd.value ? ind.macd.value.toFixed(2) : "N/A",
                signal: macdSignal,
                color: macdColor,
              };
            }

            // ë³¼ë¦°ì € ë°´ë“œ ì •ë³´ë„ ì €ì¥ (ë‚˜ì¤‘ì— ì°¨íŠ¸ì— ì‚¬ìš©)
            if (ind.bollinger_bands) {
              window.bollingerBands = ind.bollinger_bands;
            }

            console.log(`âœ… ë°±ì—”ë“œ API: ê¸°ìˆ ì  ì§€í‘œ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
            renderIndicators();
            return true;
          }
          return false;
        } catch (error) {
          console.error("âŒ ë°±ì—”ë“œ ê¸°ìˆ ì  ì§€í‘œ API ì—ëŸ¬:", error);
          return false;
        }
      }

      // 7. ë°±ì—”ë“œ API - ì¸ì‚¬ì´íŠ¸ (ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©)
      async function fetchBackendInsights() {
        try {
          console.log("ğŸ”” ë°±ì—”ë“œ API: ì¸ì‚¬ì´íŠ¸ í˜¸ì¶œ ì¤‘...");
          const response = await fetch(`${API_BASE_URL}/api/insights/recent?limit=10`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.insights && data.insights.length > 0) {
            alerts = data.insights.map((insight) => {
              const createdAt = new Date(insight.created_at);
              const timeDiff = Math.floor((Date.now() - createdAt.getTime()) / 60000);
              const timeAgo = timeDiff < 60
                ? `${timeDiff}m ago`
                : `${Math.floor(timeDiff / 60)}h ago`;

              // severityë¥¼ alert í˜•ì‹ìœ¼ë¡œ ë³€í™˜
              let severity = "info";
              if (insight.severity === "critical") severity = "critical";
              else if (insight.severity === "high") severity = "warning";
              else if (insight.severity === "medium") severity = "warning";
              else severity = "info";

              return {
                severity: severity,
                time: timeAgo,
                message: insight.description || `${insight.type}: ${insight.symbol}`,
              };
            });

            console.log(`âœ… ë°±ì—”ë“œ API: ${alerts.length}ê°œ ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸`);
            renderAlerts();
            return true;
          }
          return false;
        } catch (error) {
          console.error("âŒ ë°±ì—”ë“œ ì¸ì‚¬ì´íŠ¸ API ì—ëŸ¬:", error);
          return false;
        }
      }

      // í—¬í¼ í•¨ìˆ˜ë“¤
      function formatVolume(volume) {
        if (volume >= 1e9) return (volume / 1e9).toFixed(1) + "B";
        if (volume >= 1e6) return (volume / 1e6).toFixed(0) + "M";
        return volume.toLocaleString();
      }

      function updateChart(candleData) {
        if (chartInstance) {
          chartInstance.data.datasets[0].data = candleData;
          chartInstance.update("none");
        }
      }

      // í‹°ì»¤ ë°” ë Œë”ë§
      function renderTickerBar() {
        const tickerBar = document.getElementById("tickerBar");
        tickerBar.innerHTML = markets
          .map(
            (m) => `
          <div class="ticker-item" onclick="handleCoinClick('${m.symbol}')" style="cursor: pointer;" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ ë³´ê¸°">
            <span class="ticker-symbol">${m.symbol}</span>
            <span class="ticker-price">$${m.price.toLocaleString()}</span>
            <span class="ticker-change ${m.change >= 0 ? "up" : "down"}">
              ${m.change >= 0 ? "+" : ""}${m.change}%
            </span>
          </div>
        `
          )
          .join("");
      }

      // ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      function renderMarketList() {
        const marketList = document.getElementById("marketList");
        marketList.innerHTML = markets
          .map(
            (m, i) => `
          <div class="market-item ${i === 0 ? "active" : ""}" data-coin-symbol="${m.symbol}" data-coin-id="${m.coinId || ''}" onclick="handleCoinClick('${m.symbol}')" style="cursor: pointer;">
            <div>
              <div class="market-symbol">${m.symbol}</div>
              <div style="font-size: 0.8em; color: #848e9c;">Vol ${
                m.volume
              }</div>
            </div>
            <div class="market-price">
              <div class="market-price-value">$${m.price.toLocaleString()}</div>
              <div style="font-size: 0.8em; color: ${
                m.change >= 0 ? "#0ecb81" : "#f6465d"
              }">
                ${m.change >= 0 ? "+" : ""}${m.change}%
              </div>
            </div>
          </div>
        `
          )
          .join("");
      }

      // ì½”ì¸ ID ë§¤í•‘ (ì‹¬ë³¼ -> CoinGecko ID)
      const coinIdMap = {
        'BTC/USDT': 'bitcoin',
        'ETH/USDT': 'ethereum',
        'BNB/USDT': 'binancecoin',
        'SOL/USDT': 'solana',
        'ADA/USDT': 'cardano',
        'XRP/USDT': 'ripple',
        'DOT/USDT': 'polkadot',
        'DOGE/USDT': 'dogecoin'
      };

      // ì½”ì¸ í´ë¦­ í•¸ë“¤ëŸ¬
      async function handleCoinClick(symbol) {
        // markets ë°°ì—´ì—ì„œ í•´ë‹¹ ì½”ì¸ ì°¾ê¸°
        const market = markets.find(m => m.symbol === symbol);
        const coinId = market?.coinId || coinIdMap[symbol] || symbol.toLowerCase().split('/')[0];
        await showCoinDetail(coinId, symbol);

        // ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ì—ì„œ í™œì„±í™” í‘œì‹œ
        document.querySelectorAll('.market-item').forEach(item => {
          item.classList.remove('active');
        });
        document.querySelector(`[data-coin-symbol="${symbol}"]`)?.classList.add('active');
      }

      // ì½”ì¸ ìƒì„¸ ì •ë³´ í‘œì‹œ (demo.html ë°©ì‹)
      async function showCoinDetail(coinId, symbol) {
        const detailPanel = document.getElementById('coinDetailPanel');
        const detailContent = document.getElementById('coinDetailContent');
        const detailTitle = document.getElementById('coinDetailTitle');

        detailPanel.style.display = 'block';
        detailContent.innerHTML = '<div class="loading">ì¸ì‚¬ì´íŠ¸ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...</div>';

        try {
          console.log(`ğŸ’¡ ì½”ì¸ ìƒì„¸ ì •ë³´ ë¡œë“œ ì¤‘: ${coinId}`);
          const response = await fetch(
            `https://api.coingecko.com/api/v3/coins/${coinId}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          const price = data.market_data.current_price.usd;
          const change24h = data.market_data.price_change_percentage_24h;
          const marketCap = data.market_data.market_cap.usd;
          const volume24h = data.market_data.total_volume.usd;
          const high24h = data.market_data.high_24h.usd;
          const low24h = data.market_data.low_24h.usd;

          // AI ê¸°ë°˜ íˆ¬ì ì¸ì‚¬ì´íŠ¸ ìƒì„± (demo.html ë°©ì‹)
          const sentiment = change24h > 0 ? "positive" : "negative";
          const recommendation =
            change24h > 5
              ? "ê°•ë ¥ ë§¤ìˆ˜"
              : change24h > 2
              ? "ë§¤ìˆ˜"
              : change24h > -2
              ? "ê´€ë§"
              : change24h > -5
              ? "ë§¤ë„"
              : "ê°•ë ¥ ë§¤ë„";

          detailTitle.textContent = `${data.name} (${data.symbol.toUpperCase()})`;

          const insightHtml = `
            <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: 10px; padding: 20px; margin-bottom: 15px;">
              <div style="font-size: 1.2em; font-weight: 700; margin-bottom: 10px; color: #eaecef;">
                AI ì¶”ì²œ: <span style="color: ${change24h > 0 ? '#0ecb81' : '#f6465d'}">${recommendation}</span>
              </div>
              <div style="font-size: 0.95em; line-height: 1.6; color: #848e9c;">
                í˜„ì¬ ${data.name}ì€(ëŠ”) 24ì‹œê°„ ë™ì•ˆ ${Math.abs(change24h).toFixed(2)}% ${change24h > 0 ? "ìƒìŠ¹" : "í•˜ë½"}í–ˆìŠµë‹ˆë‹¤.
                ${
                  change24h > 3
                    ? "ê°•í•œ ìƒìŠ¹ì„¸ë¥¼ ë³´ì´ê³  ìˆì–´ ë‹¨ê¸° íˆ¬ì ê¸°íšŒë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                    : change24h < -3
                    ? "í•˜ë½ì„¸ê°€ ì§€ì†ë˜ê³  ìˆì–´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤."
                    : "ì•ˆì •ì ì¸ ì›€ì§ì„ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤."
                }
                <br><br>
                ì‹œê°€ì´ì•¡ ê¸°ì¤€ ${data.market_cap_rank || "N/A"}ìœ„ë¥¼ ê¸°ë¡í•˜ê³  ìˆìœ¼ë©°,
                24ì‹œê°„ ê±°ë˜ëŸ‰ì€ $${(volume24h / 1e9).toFixed(2)}Bë¡œ
                ${volume24h > marketCap * 0.05 ? "ë†’ì€" : "ë³´í†µ"} ìœ ë™ì„±ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">í˜„ì¬ê°€</div>
                <div style="font-size: 1.3em; font-weight: 700; color: #eaecef;">$${price.toLocaleString()}</div>
              </div>
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">24ì‹œê°„ ë³€ë™</div>
                <div style="font-size: 1.3em; font-weight: 700; color: ${change24h > 0 ? '#0ecb81' : '#f6465d'};">
                  ${change24h > 0 ? "+" : ""}${change24h.toFixed(2)}%
                </div>
              </div>
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">24ì‹œê°„ ìµœê³ ê°€</div>
                <div style="font-size: 1.1em; font-weight: 600; color: #0ecb81;">$${high24h.toLocaleString()}</div>
              </div>
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">24ì‹œê°„ ìµœì €ê°€</div>
                <div style="font-size: 1.1em; font-weight: 600; color: #f6465d;">$${low24h.toLocaleString()}</div>
              </div>
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">ì‹œê°€ì´ì•¡</div>
                <div style="font-size: 1.1em; font-weight: 600; color: #eaecef;">$${(marketCap / 1e9).toFixed(2)}B</div>
              </div>
              <div style="background: #2b3139; padding: 15px; border-radius: 8px;">
                <div style="font-size: 0.85em; color: #848e9c; margin-bottom: 5px;">24ì‹œê°„ ê±°ë˜ëŸ‰</div>
                <div style="font-size: 1.1em; font-weight: 600; color: #eaecef;">$${(volume24h / 1e9).toFixed(2)}B</div>
              </div>
            </div>
          `;

          detailContent.innerHTML = insightHtml;

          // ì°¨íŠ¸ í—¤ë”ë„ ì—…ë°ì´íŠ¸
          document.getElementById('currentSymbol').textContent = symbol;
          document.getElementById('currentPrice').textContent = `$${price.toLocaleString()}`;
          document.getElementById('priceChange').textContent = `${change24h > 0 ? "+" : ""}${change24h.toFixed(2)}%`;
          document.getElementById('priceChange').style.color = change24h > 0 ? "#0ecb81" : "#f6465d";

          // Binance ì‹¬ë³¼ë¡œ ë³€í™˜í•˜ì—¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
          const binanceSymbol = symbol.replace('/', '');
          currentSymbol = binanceSymbol;
          await fetchBinance24hrStats(binanceSymbol);
          await fetchBinanceKlines(binanceSymbol);

          console.log(`âœ… ì½”ì¸ ìƒì„¸ ì •ë³´ ë¡œë“œ ì™„ë£Œ: ${data.name}`);
        } catch (error) {
          console.error("âŒ ì½”ì¸ ìƒì„¸ ì •ë³´ ë¡œë“œ ì—ëŸ¬:", error);
          detailContent.innerHTML = `
            <div style="padding: 20px; text-align: center; color: #848e9c;">
              ì¸ì‚¬ì´íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
              <small>${error.message}</small>
            </div>
          `;
        }
      }

      // ì½”ì¸ ìƒì„¸ ì •ë³´ íŒ¨ë„ ë‹«ê¸°
      function closeCoinDetail() {
        document.getElementById('coinDetailPanel').style.display = 'none';
      }

      // ê¸°ìˆ ì  ì§€í‘œ ë Œë”ë§
      function renderIndicators() {
        const indicatorsList = document.getElementById("indicatorsList");
        indicatorsList.innerHTML = indicators
          .map(
            (ind) => `
          <div class="indicator-row">
            <span class="indicator-name">${ind.name}</span>
            <div class="indicator-value-group">
              <span class="indicator-value" style="color: ${ind.color}">${
              ind.value
            }</span>
              <span class="indicator-signal ${
                ind.signal
              }">${ind.signal.toUpperCase()}</span>
            </div>
          </div>
        `
          )
          .join("");
      }

      // ì§€ì§€ì„ /ì €í•­ì„  ë Œë”ë§
      function renderLevels() {
        const levelsList = document.getElementById("levelsList");
        levelsList.innerHTML = levels
          .map(
            (level) => `
          <div class="level-item">
            <span class="level-type ${level.type}">
              ${level.type === "resistance" ? "R" : "S"}
            </span>
            <span class="level-price">$${level.price.toLocaleString()}</span>
            <span class="level-strength">${level.strength}</span>
          </div>
        `
          )
          .join("");
      }

      // ì•Œë¦¼ ë Œë”ë§
      function renderAlerts() {
        const alertsList = document.getElementById("alertsList");
        alertsList.innerHTML = alerts
          .map(
            (alert) => `
          <div class="alert-item ${alert.severity}">
            <div class="alert-header">
              <span class="alert-severity" style="color: ${
                alert.severity === "critical"
                  ? "#f6465d"
                  : alert.severity === "warning"
                  ? "#f0b90b"
                  : "#0ecb81"
              }">
                ${alert.severity}
              </span>
              <span class="alert-time">${alert.time}</span>
            </div>
            <div class="alert-message">${alert.message}</div>
          </div>
        `
          )
          .join("");
      }

      // ë‰´ìŠ¤ í”¼ë“œ ë Œë”ë§
      function renderNews() {
        const newsFeed = document.getElementById("newsFeed");
        newsFeed.innerHTML = news
          .map(
            (item) => `
          <div class="news-item">
            <div class="news-header">
              <span class="news-source">${item.source}</span>
              <span class="news-time">${item.time}</span>
            </div>
            <div class="news-headline">${item.headline}</div>
            <span class="news-sentiment ${item.sentiment}">
              ${
                item.sentiment === "positive"
                  ? "ğŸ“ˆ Bullish"
                  : item.sentiment === "negative"
                  ? "ğŸ“‰ Bearish"
                  : "ğŸ“Š Neutral"
              }
            </span>
          </div>
        `
          )
          .join("");
      }

      // Chart.js ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ì´ˆê¸°í™”
      function initChart() {
        const ctx = document.getElementById("priceChart").getContext("2d");

        chartInstance = new Chart(ctx, {
          type: "candlestick",
          data: {
            datasets: [
              {
                label: currentSymbol,
                data: [],
                color: {
                  up: "#0ecb81",
                  down: "#f6465d",
                  unchanged: "#848e9c",
                },
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: "#1e2329",
                titleColor: "#eaecef",
                bodyColor: "#eaecef",
                borderColor: "#2b3139",
                borderWidth: 1,
              },
            },
            scales: {
              x: {
                type: "time",
                time: {
                  unit: "hour",
                },
                grid: {
                  color: "#2b3139",
                },
                ticks: {
                  color: "#848e9c",
                },
              },
              y: {
                grid: {
                  color: "#2b3139",
                },
                ticks: {
                  color: "#848e9c",
                },
              },
            },
          },
        });

        // ì°¨íŠ¸ ì´ˆê¸°í™”ë§Œ ìˆ˜í–‰, ë°ì´í„°ëŠ” ë³„ë„ë¡œ ë¡œë“œ
        console.log("ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ (ë°ì´í„°ëŠ” APIì—ì„œ ë¡œë“œ ì˜ˆì •)");
      }

      // ì´ˆê¸°í™” ë° ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("ğŸš€ CoinTicker Live Dashboard ì‹œì‘");
        console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        // 1ë‹¨ê³„: ì´ˆê¸° ë”ë¯¸ ë°ì´í„°ë¡œ ë¨¼ì € í™”ë©´ ë Œë”ë§ (ì¦‰ì‹œ í‘œì‹œ)
        console.log("ğŸ“Œ 1ë‹¨ê³„: ì´ˆê¸° ë°ì´í„°ë¡œ í™”ë©´ ë Œë”ë§ ì¤‘...");
        renderTickerBar();
        renderMarketList();
        renderIndicators();
        renderLevels();
        renderAlerts();
        renderNews();
        initChart();
        console.log("âœ… ì´ˆê¸° í™”ë©´ ë Œë”ë§ ì™„ë£Œ!");

        // 2ë‹¨ê³„: ì‹¤ì‹œê°„ API ë°ì´í„° ë¡œë“œ (ë°±ì—”ë“œ ìš°ì„ , ì—†ìœ¼ë©´ ì™¸ë¶€ API)
        console.log("\nğŸ“Œ 2ë‹¨ê³„: ì‹¤ì‹œê°„ API ë°ì´í„° ë¡œë“œ ì¤‘...");
        console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        try {
          // ë°±ì—”ë“œ API ì‹œë„
          const backendMarketSuccess = await fetchBackendMarketTrends();
          const backendNewsSuccess = await fetchBackendNews();
          await fetchBackendTechnicalIndicators("BTC");
          await fetchBackendInsights();

          // ë°±ì—”ë“œì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì™¸ë¶€ API ì‚¬ìš©
          if (!backendMarketSuccess) {
            console.log("ğŸ“Œ ë°±ì—”ë“œ ì‹œì¥ ë°ì´í„° ì—†ìŒ, CoinGecko API ì‚¬ìš©");
            await fetchCoinGeckoPrices();
          }

          if (!backendNewsSuccess) {
            console.log("ğŸ“Œ ë°±ì—”ë“œ ë‰´ìŠ¤ ë°ì´í„° ì—†ìŒ, CryptoCompare API ì‚¬ìš©");
            await fetchCryptoNews();
          }

          // ì°¨íŠ¸ ë°ì´í„°ëŠ” í•­ìƒ Binance API ì‚¬ìš© (ë°±ì—”ë“œì— OHLCV ë°ì´í„°ê°€ ì—†ì„ ìˆ˜ ìˆìŒ)
          await Promise.all([
            fetchBinance24hrStats(currentSymbol),
            fetchBinanceKlines(currentSymbol),
          ]);

          console.log("\nâœ… ëª¨ë“  API ë°ì´í„° ë¡œë“œ ì™„ë£Œ!");
        } catch (error) {
          console.error("âš ï¸ ì¼ë¶€ API ë¡œë“œ ì‹¤íŒ¨:", error);
          console.log("ğŸ“Œ ê¸°ë³¸ ë°ì´í„°ë¡œ ê³„ì† ìš´ì˜ë©ë‹ˆë‹¤.");
        }

        // 3ë‹¨ê³„: ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •
        console.log("\nğŸ“Œ 3ë‹¨ê³„: ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ ì„¤ì •...");
        console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

        // ê°€ê²© ë°ì´í„° ì—…ë°ì´íŠ¸ (30ì´ˆë§ˆë‹¤)
        setInterval(async () => {
          console.log("\nğŸ”„ [30ì´ˆ ì£¼ê¸°] ê°€ê²© ë°ì´í„° ì—…ë°ì´íŠ¸...");
          const backendSuccess = await fetchBackendMarketTrends();
          if (!backendSuccess) {
            await fetchCoinGeckoPrices();
          }
          await fetchBinance24hrStats(currentSymbol);
        }, 30000);

        // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ (1ë¶„ë§ˆë‹¤)
        setInterval(() => {
          console.log("\nğŸ”„ [1ë¶„ ì£¼ê¸°] ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸...");
          fetchBinanceKlines(currentSymbol);
        }, 60000);

        // ë‰´ìŠ¤ ì—…ë°ì´íŠ¸ (5ë¶„ë§ˆë‹¤)
        setInterval(async () => {
          console.log("\nğŸ”„ [5ë¶„ ì£¼ê¸°] ë‰´ìŠ¤ í”¼ë“œ ì—…ë°ì´íŠ¸...");
          const backendSuccess = await fetchBackendNews();
          if (!backendSuccess) {
            fetchCryptoNews();
          }
        }, 300000);

        // ê¸°ìˆ ì  ì§€í‘œ ì—…ë°ì´íŠ¸ (5ë¶„ë§ˆë‹¤)
        setInterval(() => {
          console.log("\nğŸ”„ [5ë¶„ ì£¼ê¸°] ê¸°ìˆ ì  ì§€í‘œ ì—…ë°ì´íŠ¸...");
          fetchBackendTechnicalIndicators("BTC");
        }, 300000);

        // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸ (10ë¶„ë§ˆë‹¤)
        setInterval(() => {
          console.log("\nğŸ”„ [10ë¶„ ì£¼ê¸°] ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸...");
          fetchBackendInsights();
        }, 600000);

        console.log("âœ… ìë™ ì—…ë°ì´íŠ¸ ì„¤ì • ì™„ë£Œ!");
        console.log("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        console.log("ğŸ‰ CoinTicker Live Dashboard ì¤€ë¹„ ì™„ë£Œ!");
        console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        console.log("ğŸ“Š ë°±ì—”ë“œ API: ì‹œì¥ íŠ¸ë Œë“œ, ë‰´ìŠ¤, ê¸°ìˆ ì  ì§€í‘œ, ì¸ì‚¬ì´íŠ¸");
        console.log("ğŸ“ˆ Binance API: ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ (1ë¶„ ì£¼ê¸°)");
        console.log("ğŸ“° ì™¸ë¶€ API: ë°±ì—”ë“œ ë°ì´í„° ì—†ì„ ë•Œ ëŒ€ì²´ ì‚¬ìš©");
        console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
      });
    </script>
  </body>
</html>
