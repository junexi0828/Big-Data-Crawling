# 시스템 리소스 관리 계획

**작성일**: 2025-12-07
**상태**: 🟡 리소스 과부하 대응 필요

---

## 📋 현황

### 현재 상황
- **모니터링 대상**: 실제 로컬 노트북 리소스 (가상환경 아님)
- **과부하 상태**: CPU 97%, RAM 80-85%
- **실행 중인 프로세스**: 15개+ (Spider, Kafka Consumer, HDFS, Backend, Frontend 등)

### 리소스 측정 방식
- `psutil` 라이브러리 사용
- 실제 시스템 리소스 측정 (가상환경과 무관)
- `psutil.cpu_percent()`, `psutil.virtual_memory()` 등

---

## 🎯 관리 전략

### 1. 모니터링 최적화

#### 업데이트 주기 조정
- **현재**: 2초마다 업데이트
- **권장**: 5-10초로 조정
- **효과**: CPU 사용량 50% 감소 예상

#### 측정 방식 개선
```python
# 현재: interval=None (논블로킹, 부정확할 수 있음)
cpu_percent = psutil.cpu_percent(interval=None)

# 개선: 캐싱 + 배치 업데이트
# - 5초마다 한 번만 실제 측정
# - 나머지 시간은 캐시된 값 사용
```

### 2. 프로세스 관리

#### 자동 스케줄링
- **Spider**: 동시 실행 개수 제한 (최대 2-3개)
- **Kafka Consumer**: 단일 인스턴스만 유지
- **불필요한 프로세스**: 자동 정리

#### 리소스 우선순위
1. **필수**: Backend, Frontend, Kafka Consumer
2. **선택적**: Spider (스케줄 기반 실행)
3. **수동**: MapReduce (필요 시만)

### 3. 리소스 임계값 설정

#### 경고 기준
- CPU > 80%: 경고 표시
- CPU > 90%: 자동 조치 (불필요한 프로세스 중지)
- RAM > 85%: 경고 표시
- RAM > 90%: 자동 조치

#### 자동 조치
- 낮은 우선순위 프로세스 자동 중지
- 사용자에게 알림 표시
- 로그 기록

### 4. 모니터링 주기 최적화

#### 현재 구조
```python
# app.py
stats_timer = QTimer()
stats_timer.timeout.connect(self._update_all_stats)
stats_timer.start(2000)  # 2초마다
```

#### 개선안
```python
# 리소스별 다른 주기
resource_timer = QTimer()  # 5초 (시스템 자원)
pipeline_timer = QTimer()  # 3초 (파이프라인 상태)
process_timer = QTimer()   # 2초 (프로세스 상태)
```

---

## 🔧 구현 계획

### Phase 1: 모니터링 최적화 (즉시)
- [ ] 업데이트 주기 2초 → 5초로 변경
- [ ] 리소스 측정 캐싱 추가 (5초 TTL)
- [ ] 배치 업데이트 구현

### Phase 2: 자동 관리 (단기)
- [ ] 리소스 임계값 설정
- [ ] 자동 프로세스 중지 로직
- [ ] 사용자 알림 시스템

### Phase 3: 스케줄링 (중기)
- [ ] Spider 동시 실행 제한
- [ ] 리소스 기반 스케줄링
- [ ] 우선순위 기반 프로세스 관리

---

## 📊 예상 효과

| 항목 | 현재 | 개선 후 | 감소율 |
|------|------|---------|--------|
| CPU 사용량 | 97% | 50-60% | ~40% |
| 모니터링 오버헤드 | 높음 | 낮음 | ~50% |
| 응답성 | 느림 | 정상 | 개선 |

---

## ⚠️ 주의사항

1. **가상환경 vs 실제 리소스**
   - 가상환경은 패키지 격리만 제공
   - 실제 CPU/RAM은 호스트 시스템 사용
   - GUI 표시는 실제 노트북 리소스

2. **과부하 시 조치**
   - 불필요한 프로세스 수동 중지
   - 모니터링 주기 임시 증가
   - 시스템 재시작 고려

---

## 📝 참고

- `SystemMonitor`: `gui/modules/managers/system_monitor.py`
- 모니터링 타이머: `gui/app.py` (stats_timer)
- 프로세스 관리: `gui/modules/pipeline_orchestrator.py`

